# تعليمات نشر نظام inzo Winner على خوادم الشركة

هذا الدليل مخصص لفريق تقنية المعلومات المسؤول عن نشر وتشغيل النظام على الخوادم الداخلية للشركة.

---

## نظرة عامة على البنية

يتكون النظام من جزأين رئيسيين:
1.  **التطبيق (Node.js):** وهو الكود الموجود في هذا المجلد، المسؤول عن تشغيل منطق النظام وواجهاته.
2.  **قاعدة البيانات (MongoDB):** وهي نظام منفصل لتخزين جميع البيانات (الوكلاء، المسابقات، إلخ).

**ملاحظة هامة:** تم تصميم النظام ليعمل مع قاعدة بيانات **مثبتة على نفس السيرفر** الذي يعمل عليه التطبيق. لا يتطلب النظام استخدام أي خدمات سحابية لقواعد البيانات.

---

## إثبات أن قاعدة البيانات محلية (على السيرفر)

للتأكيد وإزالة أي لبس، قاعدة البيانات تعمل بشكل كامل على السيرفر المحلي ولا يتم استخدام أي خدمات سحابية. الدليل القاطع على ذلك هو **رابط الاتصال (Connection String)** الذي يتم إنشاؤه تلقائياً في ملف الإعدادات `backend/.env`:

```
MONGODB_URI=mongodb://127.0.0.1:27017/inzo-db
```

**شرح الرابط:**
-   `mongodb://`: يشير إلى أننا نتصل بقاعدة بيانات من نوع MongoDB.
-   `127.0.0.1`: هو عنوان IP ثابت ومعروف عالمياً يعني **"هذا الجهاز نفسه"** أو **"localhost"**. هذا يؤكد أن التطبيق يبحث عن قاعدة البيانات على نفس السيرفر الذي يعمل عليه.
-   `27017`: هو المنفذ (Port) الافتراضي لـ MongoDB.
-   `inzo-db`: هو اسم قاعدة البيانات التي سيتم إنشاؤها واستخدامها.

بناءً على هذا الإعداد، من المستحيل أن يتصل النظام بأي قاعدة بيانات خارجية أو سحابية ما لم يتم تغيير هذا الرابط يدوياً.

---

## خطوات الإعداد على السيرفر (لمرة واحدة فقط)

### 1. تثبيت المتطلبات الأساسية

يجب التأكد من تثبيت البرامج التالية على السيرفر:
-   **Node.js** (إصدار 16 أو أحدث).
-   **Git**.
-   **MongoDB Community Server** (إصدار 5 أو أحدث).

### 2. تحميل وتهيئة التطبيق

أ. افتح نافذة الأوامر (CMD أو PowerShell) على السيرفر.

ب. قم بتحميل الكود باستخدام الأمر التالي:
   ```bash
   git clone https://github.com/Jimmy229922/inzo-winner-app.git
   ```

ج. ادخل إلى مجلد البرنامج وقم بتشغيل ملف الإعداد:
   ```bash
   cd inzo-winner-app
   setup.bat
   ```
   سيقوم هذا الأمر بتثبيت المكونات وإنشاء ملف الإعدادات `backend/.env` تلقائياً. **لا داعي لتعديل أي شيء في هذا الملف**، حيث أنه مهيأ مسبقاً للاتصال بقاعدة البيانات المثبتة على نفس السيرفر.

---

### 3. إعداد وتشغيل الخادم (لمرة واحدة فقط)

أ. **تشغيل الخادم كخدمة دائمة:** لضمان عمل النظام بشكل مستمر حتى بعد إعادة تشغيل السيرفر، يجب تشغيل التطبيق كخدمة في الخلفية (Background Service).

ب. **الأدوات الموصى بها:** يوصى باستخدام أدوات مثل `PM2` أو `NSSM` لإدارة هذه الخدمة. على سبيل المثال، باستخدام `PM2`، يمكن تشغيل الخادم بالأمر التالي من داخل مجلد `backend`:
   ```bash
   pm2 start server.js --name "inzo-winner-app"
   pm2 startup
   pm2 save
   ```

ج. **الوصول للنظام:** بعد تشغيل الخادم، يصبح النظام جاهزاً للاستخدام من قبل الموظفين.

---

## وصول المستخدمين النهائيين (الموظفين)

بمجرد أن يقوم مسؤول النظام بتشغيل الخادم، يمكن لجميع الموظفين الوصول إلى النظام مباشرة من خلال متصفح الويب عبر الدومين المخصص (مثال: `http://winner.inzo.company`). **لا يحتاج الموظفون إلى تثبيت أي شيء أو تشغيل أي ملفات على أجهزتهم.**

---

## آلية نشر التحديثات

عندما يتم إصدار تحديث جديد للنظام، يجب على مسؤول النظام اتباع الخطوات التالية لنشره:

1.  **الاتصال بالسيرفر:** قم بالدخول إلى السيرفر الذي يعمل عليه التطبيق.

2.  **سحب آخر التحديثات:** افتح نافذة الأوامر (CMD)، وانتقل إلى مجلد التطبيق `inzo-winner-app`، ثم قم بتنفيذ الأمر التالي لسحب آخر التغييرات من GitHub:
    ```bash
    git pull origin main
    ```

3.  **إعادة تشغيل الخدمة:** قم بإعادة تشغيل خدمة التطبيق لتطبيق التحديثات. إذا كنت تستخدم `PM2`، يمكنك استخدام الأمر التالي:
    ```bash
    pm2 restart inzo-winner-app
    ```

بمجرد إعادة تشغيل الخدمة، ستكون التحديثات متاحة لجميع الموظفين. كل ما يحتاجون إليه هو **إعادة تحميل (Refresh)** صفحة النظام في متصفحهم.